---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Sam Tancharoensuksavai">
  <main>
    <p class="cabin-700">การ์ด</p>
    <h1 class="cabin-400">Sam Tancharoensuksavai</h1>

    <div id="shape"></div>
    <button id="request-button">Enable Motion</button>
  </main>
</Layout>

<script is:inline></script>

<script>
  const shape = document.getElementById("shape");
  const requestButton = document.getElementById("request-button");

  const initializeGyroscope = () => {
    window.addEventListener("deviceorientation", (event) => {
      // Get the rotation around the z-axis (gamma) and x-axis (beta)
      const gamma = event.gamma || 0; // Left-to-right tilt
      const beta = event.beta || 0; // Front-to-back tilt

      if (!shape || gamma || beta) return;
      // Screen size limits
      const maxX = window.innerWidth - shape.offsetWidth;
      const maxY = window.innerHeight - shape.offsetHeight;

      // Calculate new position
      let x = ((gamma + 90) / 180) * maxX;
      let y = ((beta + 90) / 180) * maxY;

      // Update shape position
      shape.style.left = `${x}px`;
      shape.style.top = `${y}px`;
    });
  };

  requestButton?.addEventListener("click", async () => {
    //@ts-ignore
    if (!DeviceMotionEvent?.requestPermission) return;

    //@ts-ignore
    if (typeof DeviceMotionEvent.requestPermission === "function") {
      try {
        //@ts-ignore
        const response = await DeviceMotionEvent.requestPermission();
        if (response === "granted") {
          initializeGyroscope();
          requestButton.style.display = "none";
        } else {
          alert("Permission denied for accessing device orientation.");
        }
      } catch (error) {
        console.error("Error requesting permission:", error);
      }
    } else {
      // If not iOS, just initialize
      initializeGyroscope();
      requestButton.style.display = "none";
    }
  });
</script>

<style>
  main {
    height: 100dvh;
    margin: auto;
    color: #e9e9e9;
    background: black;
    display: flex;
    place-items: center;
    place-content: center;
    flex-direction: column;
    width: 100%;
    text-align: center;
  }

  h1 {
    font-weight: 100;
    font-size: var(--font-size);
  }

  p {
    margin-top: 0;
    font-size: var(--font-size);
    font-weight: 100;
  }

  #shape {
    width: 50px;
    height: 50px;
    background-color: #00f;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
  }
</style>
